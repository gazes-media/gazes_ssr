var v=Object.defineProperty;var a=(r,t,i)=>t in r?v(r,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):r[t]=i;var d=(r,t,i)=>(a(r,typeof t!="symbol"?t+"":t,i),i);import{k as f,l as p,D as h,m as g,n as m,o as L,q as S,s as w,v as y}from"./index-9270702c.js";import{VideoProvider as E}from"./provider-30ce612c.js";import{a as H}from"./provider-f3754178.js";class x{constructor(t,i,e){this.di=t,this.ph=i,this._e=e,this.ei()}async ei(){const t={onLoadStart:this.ge.bind(this),onLoaded:this.ue.bind(this),onLoadError:this.fi.bind(this)};let i=await D(this.di,t);if(f(i)&&!p(this.di)&&(i=await j(this.di,t)),!i)return null;if(!i.isSupported()){const e="[vidstack]: `hls.js` is not supported in this environment";return this.ph.player.dispatchEvent(new h("hls-unsupported")),this.ph.delegate.R("error",{detail:{message:e,code:4}}),null}return i}ge(){this.ph.player.dispatchEvent(new h("hls-lib-load-start"))}ue(t){this.ph.player.dispatchEvent(new h("hls-lib-loaded",{detail:t})),this._e(t)}fi(t){const i=g(t);this.ph.player.dispatchEvent(new h("hls-lib-load-error",{detail:i})),this.ph.delegate.R("error",{detail:{message:i.message,code:4}})}}async function j(r,t={}){var i,e,n,o,u;if(!f(r)){if((i=t.onLoadStart)==null||i.call(t),r.prototype&&r.prototype!==Function)return(e=t.onLoaded)==null||e.call(t,r),r;try{const s=(n=await r())==null?void 0:n.default;if(s&&s.isSupported)(o=t.onLoaded)==null||o.call(t,s);else throw Error("");return s}catch(s){(u=t.onLoadError)==null||u.call(t,s)}}}async function D(r,t={}){var i,e,n;if(p(r)){(i=t.onLoadStart)==null||i.call(t);try{if(await m(r),!L(window.Hls))throw Error("");const o=window.Hls;return(e=t.onLoaded)==null||e.call(t,o),o}catch(o){(n=t.onLoadError)==null||n.call(t,o)}}}const R="https://cdn.jsdelivr.net";class _ extends E{constructor(){super(...arguments);d(this,"$$PROVIDER_TYPE","HLS");d(this,"mh",null);d(this,"xd",new H(this.video));d(this,"lh",`${R}/npm/hls.js@^1.0.0/dist/hls.min.js`)}get ctor(){return this.mh}get instance(){return this.xd.instance}get type(){return"hls"}get canLiveSync(){return!0}get config(){return this.xd.nh}set config(i){this.xd.nh=i}get library(){return this.lh}set library(i){this.lh=i}preconnect(){p(this.lh)&&w(this.lh)}setup(i){super.setup(i),new x(this.lh,i,e=>{this.mh=e,this.xd.setup(e,i),i.delegate.R("provider-setup",{detail:this});const n=y(i.$store.source);n&&this.loadSource(n)})}async loadSource({src:i}){var e;p(i)&&((e=this.xd.instance)==null||e.loadSource(i))}onInstance(i){const e=this.xd.instance;return e&&i(e),this.xd.oh.add(i),()=>this.xd.oh.delete(i)}destroy(){this.xd.Jg()}}d(_,"supported",S());export{_ as HLSProvider};
